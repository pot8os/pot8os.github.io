{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021-02-10/","result":{"data":{"site":{"siteMetadata":{"title":"pot8os"}},"markdownRemark":{"id":"dba2a92c-7ae4-55a9-afdf-b61c77d1f18d","excerpt":"というのを目論んでいたのだけど、Realmが移行する気なかったりするので完璧にRxJava2を消し去ることは出来ませんでした。\nの置換は特に造作もないけど、テストが結構失敗するようになってしまってその解決に時間がかかってしまった。結論としては何のことはなく、RxJava2をまだ何点か併用する必要があるので、Rx…","html":"<p>というのを目論んでいたのだけど、<a href=\"https://github.com/realm/realm-java/issues/6871\">Realmが移行する気なかったりする</a>ので完璧にRxJava2を消し去ることは出来ませんでした。\n<code class=\"language-text\">import</code>の置換は特に造作もないけど、テストが結構失敗するようになってしまってその解決に時間がかかってしまった。結論としては何のことはなく、RxJava2をまだ何点か併用する必要があるので、Rxを同期実行させるTestRuleにもその旨両方記載する必要があったのでした。実装例としてはこんな感じ。</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> ImmediateSchedulersRule<span class=\"token operator\">:</span> TestRule <span class=\"token punctuation\">{</span>\n  <span class=\"token annotation builtin\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>base<span class=\"token operator\">:</span> Statement<span class=\"token punctuation\">,</span> description<span class=\"token operator\">:</span> Description<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> new <span class=\"token function\">Statement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token annotation builtin\">@Override</span>\n      <span class=\"token keyword\">public</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// こっちはRxJava3</span>\n        RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">setIoSchedulerHandler</span> <span class=\"token punctuation\">{</span> Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">trampoline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">setComputationSchedulerHandler</span> <span class=\"token punctuation\">{</span> Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">trampoline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">setNewThreadSchedulerHandler</span> <span class=\"token punctuation\">{</span> Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">trampoline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// RxJava2が生きてる場合はこちらも</span>\n        io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span>RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">setIoSchedulerHandler</span> <span class=\"token punctuation\">{</span> io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>schedulers<span class=\"token punctuation\">.</span>Schedulers<span class=\"token punctuation\">.</span>Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">trampoline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span>RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">setComputationSchedulerHandler</span> <span class=\"token punctuation\">{</span> io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>schedulers<span class=\"token punctuation\">.</span>Schedulers<span class=\"token punctuation\">.</span>Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">trampoline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span>RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">setNewThreadSchedulerHandler</span> <span class=\"token punctuation\">{</span> io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>schedulers<span class=\"token punctuation\">.</span>Schedulers<span class=\"token punctuation\">.</span>Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">trampoline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n          base<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n          RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token comment\">// こちらも忘れずに</span>\n          io<span class=\"token punctuation\">.</span>reactivex<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span>RxJavaPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>結論</h3>\n<p>Realm早く辞めたい</p>","frontmatter":{"title":"RxJava2からRxJava3に移行","date":"2021-02-10"}}},"pageContext":{"slug":"/2021-02-10/","previous":{"fields":{"slug":"/2021-01-27/"},"frontmatter":{"title":"YAMLでちょっといい感じに書く"}},"next":null}},"staticQueryHashes":["3000541721"]}